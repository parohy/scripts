#!/bin/bash

if [ -z "$1" ]; then
    echo "Must provide project name or use --help"
    exit 0
fi

PROJECT_NAME="$1"

if [ $PROJECT_NAME == "--help" ]; then
    echo "configure <project_name> <prefix>"
    echo "Example: configure my_project pro"
    echo "If you do not set prefix, it will be autogenerated from project name."
    exit 1
fi

if [ -z "$2" ]; then 
    echo "Setting default prefix from name..."
    UPPER=$(echo $1 | tr '[:lower:]' '[:upper:]')
    PREFIX=${UPPER:0:3}
else
    PREFIX=$(echo $2 | tr '[:lower:]' '[:upper:]')
fi

PWD=$(pwd)
PROJECT=$(pwd | tr '/' ':')

OLD_CONFIG=$(grep $PROJECT ~/.executes/bin/.brconf)
NEW_CONFIG="${PROJECT}=${PROJECT_NAME}=${PREFIX}"

if [ -n "${OLD_CONFIG}" ]; then
  if [[ "$OSTYPE" == "darwin"* ]]; then
        SED_CMD="sed -i ''"
  else
        SED_CMD="sed -i"
  fi
  $SED_CMD "s/${OLD_CONFIG}/${NEW_CONFIG}/" ~/.executes/bin/.brconf
else
  echo "${NEW_CONFIG}" >> ~/.executes/bin/.brconf
fi

